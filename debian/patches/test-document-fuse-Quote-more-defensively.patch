From: Simon McVittie <smcv@debian.org>
Date: Wed, 5 Aug 2020 11:16:35 +0100
Subject: test-document-fuse: Quote more defensively

Signed-off-by: Simon McVittie <smcv@debian.org>
Forwarded: https://github.com/flatpak/xdg-desktop-portal/pull/521
---
 tests/test-document-fuse.sh | 30 +++++++++++++++---------------
 1 file changed, 15 insertions(+), 15 deletions(-)

diff --git a/tests/test-document-fuse.sh b/tests/test-document-fuse.sh
index da0aa47..f0013d4 100755
--- a/tests/test-document-fuse.sh
+++ b/tests/test-document-fuse.sh
@@ -25,20 +25,20 @@ set -e
 if [ -n "${G_TEST_SRCDIR:-}" ]; then
     test_srcdir="${G_TEST_SRCDIR}"
 else
-    test_srcdir=$(realpath $(dirname $0))
+    test_srcdir=$(realpath "$(dirname $0)")
 fi
 
 if [ -n "${G_TEST_BUILDDIR:-}" ]; then
     test_builddir="${G_TEST_BUILDDIR}"
 else
-    test_builddir=$(realpath $(dirname $0))
+    test_builddir=$(realpath "$(dirname $0)")
 fi
 
 export TEST_DATA_DIR=`mktemp -d /tmp/xdp-XXXXXX`
-mkdir -p ${TEST_DATA_DIR}/home
-mkdir -p ${TEST_DATA_DIR}/runtime
-mkdir -p ${TEST_DATA_DIR}/system
-mkdir -p ${TEST_DATA_DIR}/config
+mkdir -p "${TEST_DATA_DIR}/home"
+mkdir -p "${TEST_DATA_DIR}/runtime"
+mkdir -p "${TEST_DATA_DIR}/system"
+mkdir -p "${TEST_DATA_DIR}/config"
 
 export HOME=${TEST_DATA_DIR}/home
 export XDG_CACHE_HOME=${TEST_DATA_DIR}/home/cache
@@ -47,15 +47,15 @@ export XDG_DATA_HOME=${TEST_DATA_DIR}/home/share
 export XDG_RUNTIME_DIR=${TEST_DATA_DIR}/runtime
 
 cleanup () {
-    fusermount -u $XDG_RUNTIME_DIR/doc || :
+    fusermount -u "$XDG_RUNTIME_DIR/doc" || :
     sleep 0.1
-    kill -9 $DBUS_SESSION_BUS_PID
+    kill -9 "$DBUS_SESSION_BUS_PID"
     kill $(jobs -p) &> /dev/null || true
-    rm -rf $TEST_DATA_DIR
+    rm -rf "$TEST_DATA_DIR"
 }
 trap cleanup EXIT
 
-sed s#@testdir@#${test_builddir}# ${test_srcdir}/session.conf.in > session.conf
+sed "s#@testdir@#${test_builddir}#" "${test_srcdir}/session.conf.in" > session.conf
 
 dbus-daemon --fork --config-file=session.conf --print-address=3 --print-pid=4 \
             3> dbus-session-bus-address 4> dbus-session-bus-pid
@@ -76,20 +76,20 @@ fi
 
 # First run a basic single-thread test
 echo Testing single-threaded
-${test_srcdir}/test-document-fuse.py --iterations 3 -v
+"${test_srcdir}/test-document-fuse.py" --iterations 3 -v
 echo "ok single-threaded"
 
 # Then a bunch of copies in parallel to stress-test
 echo Testing in parallel
 PIDS=()
 for i in $(seq 20); do
-    ${test_srcdir}/test-document-fuse.py --iterations 10 --prefix $i &
+    "${test_srcdir}/test-document-fuse.py" --iterations 10 --prefix "$i" &
     PID="$!"
     PIDS+=( "$PID" )
 done
 
-for PID in ${PIDS[@]}; do
-    echo waiting for pid ${PID}
-    wait ${PID}
+for PID in "${PIDS[@]}"; do
+    echo waiting for pid "${PID}"
+    wait "${PID}"
 done
 echo "ok load-test"
